<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Commission Management Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #12096d 0%, #18efe4 100%);
            min-height: 100vh;
            color: #2d3748;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .login-container {
            background: white;
            border-radius: 12px;
            padding: 48px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            max-width: 480px;
            margin: 10vh auto;
            text-align: center;
        }

        .login-title {
            font-size: 28px;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 32px;
        }

        .header {
            background: white;
            border-radius: 12px;
            padding: 20px 32px;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-logo {
            font-size: 20px;
            font-weight: 600;
            color: #1a202c;
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 8px;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .nav-tab {
            flex: 1;
            padding: 12px 24px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            color: #4a5568;
            border: none;
            background: none;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #12096d 0%, #18efe4 100%);
            color: white;
        }

        .main-content {
            background: white;
            border-radius: 12px;
            padding: 32px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e2e8f0;
        }

        .content-title {
            font-size: 24px;
            font-weight: 600;
            color: #1a202c;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #12096d 0%, #18efe4 100%);
            color: white;
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-secondary {
            background: #edf2f7;
            color: #4a5568;
        }

        .login-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 16px;
        }

        .role-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 12px;
            transition: all 0.2s;
        }

        .role-option:hover {
            border-color: #12096d;
            background: #f8faff;
        }

        .role-title {
            font-weight: 600;
            color: #1a202c;
        }

        .role-description {
            font-size: 14px;
            color: #4a5568;
        }

        .role-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .role-admin { background: #fed7d7; color: #c53030; }
        .role-manager { background: #c6f6d5; color: #276749; }
        .role-user { background: #bee3f8; color: #2c5282; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: linear-gradient(135deg, #12096d 0%, #18efe4 100%);
            color: white;
            padding: 24px;
            border-radius: 12px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
        }

        .data-table th {
            background: #f7fafc;
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: #2d3748;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-table td {
            padding: 16px;
            border-bottom: 1px solid #e2e8f0;
            color: #4a5568;
        }

        .data-table tbody tr:hover {
            background: #f8faff;
        }

        .hidden { display: none; }
        .text-center { text-align: center; }

        .file-upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 12px;
            padding: 32px;
            text-align: center;
            margin-bottom: 24px;
        }

        .file-input {
            margin: 8px 0;
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
        }

        .activity-log {
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            font-family: monospace;
            font-size: 13px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 24px;
        }

        .tier-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .tier-base { background: #e6fffa; color: #234e52; }
        .tier-1 { background: #ffeaa7; color: #8b4513; }
        .tier-2 { background: #fab1a0; color: #8b0000; }
    </style>
</head>
<body>
    <div class="container">
        <div id="loginScreen" class="login-container">
            <div style="margin-bottom: 32px; text-align: center;">
                <svg height="48" viewBox="0 0 1500 952.02" style="max-width: 240px;">
                    <defs>
                        <linearGradient id="login-logo-gradient" x1="427.35" y1="288.78" x2="1055.89" y2="288.78" gradientUnits="userSpaceOnUse">
                            <stop offset="0" stop-color="#18efe4"/>
                            <stop offset="1" stop-color="#12096d"/>
                        </linearGradient>
                        <linearGradient id="login-logo-gradient-2" x1="216.99" y1="839.76" x2="1268.21" y2="839.76" gradientUnits="userSpaceOnUse">
                            <stop offset="0" stop-color="#18efe4"/>
                            <stop offset="1" stop-color="#12096d"/>
                        </linearGradient>
                    </defs>
                    <g>
                        <polygon fill="url(#login-logo-gradient)" points="451.77 560.41 740.26 59.41 1031.42 560.41 1055.89 560.41 740.17 17.16 427.35 560.41 451.77 560.41"/>
                        <polygon fill="url(#login-logo-gradient-2)" points="1143.81 753.79 1231.44 904.58 253.59 904.58 340.42 753.79 316 753.79 216.99 925.74 1268.21 925.74 1168.28 753.79 1143.81 753.79"/>
                    </g>
                    <g fill="#12096d">
                        <path d="M97.81,605.73c8.14,7.07,12.22,16.98,12.22,29.73s-4.1,23.67-12.3,31.01c-8.2,7.35-19.71,11.02-34.52,11.02h-29.73v37.25h-16.4v-119.61h46.14c14.92,0,26.46,3.53,34.6,10.6ZM86.11,655.88c5.47-4.5,8.2-11.13,8.2-19.91s-2.73-15.01-8.2-19.4c-5.47-4.38-13.33-6.58-23.58-6.58l-29.05.17v52.46h29.05c10.25,0,18.11-2.25,23.58-6.75Z"/>
                        <path d="M256.3,714.75l-12.64-29.05h-63.05l-12.47,29.05h-17.26l53.14-119.61h17.09l52.97,119.61h-17.77ZM187.1,670.84h50.24l-25.29-58.1-24.95,58.1Z"/>
                        <path d="M411.45,714.75l-23.75-37.59c-2.73.23-4.96.34-6.66.34h-30.42v37.25h-16.4v-119.61h46.82c15.15,0,26.85,3.5,35.12,10.51,8.26,7.01,12.39,16.95,12.39,29.82,0,9.68-2.25,17.83-6.75,24.43-4.5,6.61-10.96,11.39-19.39,14.35l27.85,40.5h-18.8ZM381.03,662.63c10.25,0,18.11-2.25,23.58-6.75,5.47-4.5,8.2-11.13,8.2-19.91s-2.73-15.01-8.2-19.4c-5.47-4.38-13.33-6.58-23.58-6.58h-30.42v52.63h30.42Z"/>
                        <path d="M591.55,714.75l-12.64-29.05h-63.05l-12.47,29.05h-17.26l53.14-119.61h17.09l52.97,119.61h-17.77ZM522.35,670.84h50.24l-25.29-58.1-24.95,58.1Z"/>
                        <path d="M669.46,595.14h19.48l43.74,84.07,43.4-84.07h19.65v119.61h-15.38l-.17-95.52-42.55,82.88h-10.08l-42.89-82.88v95.52h-15.21v-119.61Z"/>
                        <path d="M956.62,602.14c9.63,5.36,17.23,12.67,22.81,21.96,5.58,9.29,8.37,19.51,8.37,30.67s-2.79,21.44-8.37,30.84c-5.58,9.4-13.19,16.8-22.81,22.21-9.63,5.41-20.19,8.12-31.7,8.12s-22.07-2.7-31.7-8.12c-9.63-5.41-17.23-12.82-22.81-22.21-5.58-9.4-8.37-19.68-8.37-30.84s2.79-21.39,8.37-30.67c5.58-9.28,13.16-16.6,22.73-21.96,9.57-5.35,20.16-8.03,31.78-8.03s22.07,2.68,31.7,8.03ZM901.94,614.96c-7.12,4.1-12.79,9.65-17,16.66-4.22,7.01-6.32,14.72-6.32,23.15s2.1,16.18,6.32,23.24c4.21,7.07,9.88,12.67,17,16.83,7.12,4.16,14.84,6.24,23.15,6.24s15.97-2.08,22.98-6.24c7.01-4.16,12.59-9.76,16.74-16.83,4.16-7.06,6.24-14.81,6.24-23.24s-2.08-16.15-6.24-23.15c-4.16-7.01-9.74-12.56-16.74-16.66-7.01-4.1-14.67-6.15-22.98-6.15s-16.04,2.05-23.15,6.15Z"/>
                        <path d="M1077.08,691.77c6.09,6.21,14.49,9.31,25.2,9.31s18.91-3.1,24.95-9.31c6.04-6.21,9.06-14.84,9.06-25.89v-70.74h16.4v70.74c0,15.61-4.47,27.85-13.41,36.74-8.94,8.89-21.27,13.33-36.99,13.33s-28.25-4.44-37.25-13.33c-9-8.89-13.5-21.13-13.5-36.74v-70.74h16.4v70.74c0,11.05,3.05,19.68,9.14,25.89Z"/>
                        <path d="M1312.12,595.14h16.23v119.61h-16.57l-68.35-92.61v92.61h-16.4v-119.61h16.57l68.52,92.79v-92.79Z"/>
                        <path d="M1390.04,595.14h93.47v15.04h-38.62v104.57h-16.4v-104.57h-38.45v-15.04Z"/>
                    </g>
                </svg>
            </div>
            
            <h1 class="login-title">Commission Management Portal</h1>
            
            <div id="authForm" style="margin-bottom: 24px;">
                <input type="text" id="loginUsername" class="login-input" placeholder="Username" />
                <input type="password" id="loginPassword" class="login-input" placeholder="Password" />
                <button class="btn btn-primary" style="width: 100%;" onclick="performLogin()">Sign In</button>
            </div>

            <div style="border-top: 1px solid #e2e8f0; padding-top: 24px;">
                <p style="color: #4a5568; margin-bottom: 16px;">Demo Access</p>
                
                <div class="role-option" onclick="loginAs('admin', 'System Administrator', 'ADMIN001')">
                    <div>
                        <div class="role-title">Administrator</div>
                        <div class="role-description">Full system access</div>
                    </div>
                    <div class="role-badge role-admin">Admin</div>
                </div>
                
                <div class="role-option" onclick="loginAs('manager', 'Sales Manager', 'MGR001', ['REC001', 'SAL001'])">
                    <div>
                        <div class="role-title">Manager</div>
                        <div class="role-description">Team oversight</div>
                    </div>
                    <div class="role-badge role-manager">Manager</div>
                </div>
                
                <div class="role-option" onclick="loginAs('user', 'John Smith', 'REC001')">
                    <div>
                        <div class="role-title">Employee</div>
                        <div class="role-description">Personal data access</div>
                    </div>
                    <div class="role-badge role-user">Employee</div>
                </div>
            </div>
        </div>

        <div id="mainApp" class="hidden">
            <div class="header">
                <div class="header-logo">
                    <svg height="32" viewBox="0 0 1500 952.02" style="margin-right: 12px;">
                        <defs>
                            <linearGradient id="logo-gradient" x1="427.35" y1="288.78" x2="1055.89" y2="288.78" gradientUnits="userSpaceOnUse">
                                <stop offset="0" stop-color="#18efe4"/>
                                <stop offset="1" stop-color="#12096d"/>
                            </linearGradient>
                            <linearGradient id="logo-gradient-2" x1="216.99" y1="839.76" x2="1268.21" y2="839.76" gradientUnits="userSpaceOnUse">
                                <stop offset="0" stop-color="#18efe4"/>
                                <stop offset="1" stop-color="#12096d"/>
                            </linearGradient>
                        </defs>
                        <g>
                            <polygon fill="url(#logo-gradient)" points="451.77 560.41 740.26 59.41 1031.42 560.41 1055.89 560.41 740.17 17.16 427.35 560.41 451.77 560.41"/>
                            <polygon fill="url(#logo-gradient-2)" points="1143.81 753.79 1231.44 904.58 253.59 904.58 340.42 753.79 316 753.79 216.99 925.74 1268.21 925.74 1168.28 753.79 1143.81 753.79"/>
                        </g>
                        <g fill="#12096d">
                            <path d="M97.81,605.73c8.14,7.07,12.22,16.98,12.22,29.73s-4.1,23.67-12.3,31.01c-8.2,7.35-19.71,11.02-34.52,11.02h-29.73v37.25h-16.4v-119.61h46.14c14.92,0,26.46,3.53,34.6,10.6ZM86.11,655.88c5.47-4.5,8.2-11.13,8.2-19.91s-2.73-15.01-8.2-19.4c-5.47-4.38-13.33-6.58-23.58-6.58l-29.05.17v52.46h29.05c10.25,0,18.11-2.25,23.58-6.75Z"/>
                            <path d="M256.3,714.75l-12.64-29.05h-63.05l-12.47,29.05h-17.26l53.14-119.61h17.09l52.97,119.61h-17.77ZM187.1,670.84h50.24l-25.29-58.1-24.95,58.1Z"/>
                            <path d="M411.45,714.75l-23.75-37.59c-2.73.23-4.96.34-6.66.34h-30.42v37.25h-16.4v-119.61h46.82c15.15,0,26.85,3.5,35.12,10.51,8.26,7.01,12.39,16.95,12.39,29.82,0,9.68-2.25,17.83-6.75,24.43-4.5,6.61-10.96,11.39-19.39,14.35l27.85,40.5h-18.8ZM381.03,662.63c10.25,0,18.11-2.25,23.58-6.75,5.47-4.5,8.2-11.13,8.2-19.91s-2.73-15.01-8.2-19.4c-5.47-4.38-13.33-6.58-23.58-6.58h-30.42v52.63h30.42Z"/>
                            <path d="M591.55,714.75l-12.64-29.05h-63.05l-12.47,29.05h-17.26l53.14-119.61h17.09l52.97,119.61h-17.77ZM522.35,670.84h50.24l-25.29-58.1-24.95,58.1Z"/>
                            <path d="M669.46,595.14h19.48l43.74,84.07,43.4-84.07h19.65v119.61h-15.38l-.17-95.52-42.55,82.88h-10.08l-42.89-82.88v95.52h-15.21v-119.61Z"/>
                            <path d="M956.62,602.14c9.63,5.36,17.23,12.67,22.81,21.96,5.58,9.29,8.37,19.51,8.37,30.67s-2.79,21.44-8.37,30.84c-5.58,9.4-13.19,16.8-22.81,22.21-9.63,5.41-20.19,8.12-31.7,8.12s-22.07-2.7-31.7-8.12c-9.63-5.41-17.23-12.82-22.81-22.21-5.58-9.4-8.37-19.68-8.37-30.84s2.79-21.39,8.37-30.67c5.58-9.28,13.16-16.6,22.73-21.96,9.57-5.35,20.16-8.03,31.78-8.03s22.07,2.68,31.7,8.03ZM901.94,614.96c-7.12,4.1-12.79,9.65-17,16.66-4.22,7.01-6.32,14.72-6.32,23.15s2.1,16.18,6.32,23.24c4.21,7.07,9.88,12.67,17,16.83,7.12,4.16,14.84,6.24,23.15,6.24s15.97-2.08,22.98-6.24c7.01-4.16,12.59-9.76,16.74-16.83,4.16-7.06,6.24-14.81,6.24-23.24s-2.08-16.15-6.24-23.15c-4.16-7.01-9.74-12.56-16.74-16.66-7.01-4.1-14.67-6.15-22.98-6.15s-16.04,2.05-23.15,6.15Z"/>
                            <path d="M1077.08,691.77c6.09,6.21,14.49,9.31,25.2,9.31s18.91-3.1,24.95-9.31c6.04-6.21,9.06-14.84,9.06-25.89v-70.74h16.4v70.74c0,15.61-4.47,27.85-13.41,36.74-8.94,8.89-21.27,13.33-36.99,13.33s-28.25-4.44-37.25-13.33c-9-8.89-13.5-21.13-13.5-36.74v-70.74h16.4v70.74c0,11.05,3.05,19.68,9.14,25.89Z"/>
                            <path d="M1312.12,595.14h16.23v119.61h-16.57l-68.35-92.61v92.61h-16.4v-119.61h16.57l68.52,92.79v-92.79Z"/>
                            <path d="M1390.04,595.14h93.47v15.04h-38.62v104.57h-16.4v-104.57h-38.45v-15.04Z"/>
                        </g>
                    </svg>
                    Commission Portal
                </div>
                <div>
                    <span id="userName">User Name</span> | 
                    <span id="userRole">Role</span>
                    <button class="btn btn-danger" style="margin-left: 16px;" onclick="logout()">Sign Out</button>
                </div>
            </div>

            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchTab('dashboard')">Dashboard</button>
                <button class="nav-tab" id="uploadTab" onclick="switchTab('upload')">Upload Files</button>
                <button class="nav-tab hidden" id="usersTab" onclick="switchTab('users')">User Management</button>
            </div>

            <div id="dashboardContent" class="main-content">
                <div class="content-header">
                    <h2 class="content-title" id="dashboardTitle">Commission Dashboard</h2>
                    <button class="btn btn-secondary" onclick="exportData()">Export Data</button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalCommission">$0</div>
                        <div class="stat-label">Total Commission</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalGP">$0</div>
                        <div class="stat-label">Total Gross Profit</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgCommissionRate">0%</div>
                        <div class="stat-label">Average Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="uniqueEmployees">0</div>
                        <div class="stat-label">Active Employees</div>
                    </div>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Week Ending</th>
                            <th>Employee</th>
                            <th>Client</th>
                            <th>Gross Profit</th>
                            <th>Cumulative GP</th>
                            <th>Tier</th>
                            <th>Rate</th>
                            <th>Commission</th>
                        </tr>
                    </thead>
                    <tbody id="commissionTableBody">
                        <tr>
                            <td colspan="8" class="text-center" style="padding: 48px; color: #a0aec0;">
                                Commission data will appear after login
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div id="uploadContent" class="main-content hidden">
                <div class="content-header">
                    <h2 class="content-title">Upload Commission Files</h2>
                </div>

                <div class="file-upload-area">
                    <h4 style="margin-bottom: 16px;">Master Structure File</h4>
                    <input type="file" id="masterFile" class="file-input" accept=".xlsx,.xls" />
                    <p style="color: #4a5568; font-size: 14px;">Excel file with employee commission rules</p>
                </div>

                <div class="file-upload-area">
                    <h4 style="margin-bottom: 16px;">TOA Files</h4>
                    <input type="file" id="toaFiles" class="file-input" accept=".csv,.xlsx" multiple />
                    <p style="color: #4a5568; font-size: 14px;">Bullhorn TOA files (CSV or Excel)</p>
                </div>

                <div style="text-align: center; margin-top: 32px;">
                    <button class="btn btn-success" onclick="processCommissionFiles()">Process Files</button>
                    <button class="btn btn-secondary" onclick="clearFiles()">Clear</button>
                </div>
            </div>

            <div id="usersContent" class="main-content hidden">
                <div class="content-header">
                    <h2 class="content-title">User Management</h2>
                    <button class="btn btn-success" onclick="alert('User creation feature coming soon')">Create User</button>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Full Name</th>
                            <th>Role</th>
                            <th>Employee ID</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="5" class="text-center" style="padding: 48px; color: #a0aec0;">
                                User management features will be available soon
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="activity-log" id="logContainer">
            <div>[SYSTEM] Commission Portal initialized</div>
            <div>[INFO] Ready for user authentication</div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        let currentUser = { role: null, name: null, employeeId: null, assignedEmployees: [] };
        let commissionData = [];
        let employeeRules = {};

        const PERMISSIONS = {
            VIEW_ALL_DATA: 'view_all_data',
            UPLOAD_FILES: 'upload_files',
            MANAGE_USERS: 'manage_users',
            VIEW_OWN_DATA: 'view_own_data'
        };

        const ROLE_PERMISSIONS = {
            admin: [PERMISSIONS.VIEW_ALL_DATA, PERMISSIONS.UPLOAD_FILES, PERMISSIONS.MANAGE_USERS, PERMISSIONS.VIEW_OWN_DATA],
            manager: [PERMISSIONS.VIEW_ALL_DATA, PERMISSIONS.UPLOAD_FILES, PERMISSIONS.VIEW_OWN_DATA],
            user: [PERMISSIONS.VIEW_OWN_DATA]
        };

        function performLogin() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                log('Please enter credentials', 'error');
                return;
            }
            
            log('Login functionality will be enhanced in future updates', 'info');
        }

        function loginAs(role, name, employeeId, managedEmployees = []) {
            currentUser = {
                role: role,
                name: name,
                employeeId: employeeId,
                assignedEmployees: role === 'admin' ? [] : (managedEmployees.length ? managedEmployees : [employeeId]),
                permissions: ROLE_PERMISSIONS[role] || []
            };

            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            updateUIForRole();
            loadDemoData();
            log(`Signed in as ${currentUser.name}`, 'success');
        }

        function logout() {
            currentUser = { role: null, name: null, employeeId: null, assignedEmployees: [] };
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            log('Signed out successfully', 'info');
        }

        function updateUIForRole() {
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userRole').textContent = currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1);
            
            const uploadTab = document.getElementById('uploadTab');
            const usersTab = document.getElementById('usersTab');
            
            if (currentUser.role === 'admin' || currentUser.role === 'manager') {
                uploadTab.classList.remove('hidden');
            }
            
            if (currentUser.role === 'admin') {
                usersTab.classList.remove('hidden');
            }

            const dashboardTitle = document.getElementById('dashboardTitle');
            if (currentUser.role === 'admin') {
                dashboardTitle.textContent = 'Commission Dashboard - All Employees';
            } else if (currentUser.role === 'manager') {
                dashboardTitle.textContent = 'Commission Dashboard - Your Team';
            } else {
                dashboardTitle.textContent = 'Your Commission Dashboard';
            }
        }

        function switchTab(tabName) {
            document.querySelectorAll('#dashboardContent, #uploadContent, #usersContent').forEach(el => {
                el.classList.add('hidden');
            });
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName + 'Content').classList.remove('hidden');
            event.target.classList.add('active');
        }

        function loadDemoData() {
            const demoData = [
                {
                    date: '2025-01-07',
                    employee: 'Sarah Johnson',
                    employeeId: 'REC001',
                    client: 'TechCorp Industries',
                    grossProfit: 15000,
                    cumulativeGP: 15000,
                    commissionRate: 0.30,
                    commission: 4500,
                    type: 'Recruiter',
                    tierStatus: 'Base'
                },
                {
                    date: '2025-01-14',
                    employee: 'Michael Chen',
                    employeeId: 'SAL001',
                    client: 'Global Solutions Ltd',
                    grossProfit: 22000,
                    cumulativeGP: 22000,
                    commissionRate: 0.28,
                    commission: 6160,
                    type: 'Sales',
                    tierStatus: 'Base'
                }
            ];

            if (currentUser.role === 'user') {
                commissionData = demoData.filter(record => 
                    record.employeeId === currentUser.employeeId
                );
            } else {
                commissionData = demoData;
            }

            updateDashboard();
        }

        function updateDashboard() {
            const totalCommission = commissionData.reduce((sum, record) => sum + record.commission, 0);
            const totalGP = commissionData.reduce((sum, record) => sum + record.grossProfit, 0);
            const avgCommissionRate = totalGP > 0 ? (totalCommission / totalGP) * 100 : 0;
            const uniqueEmployees = new Set(commissionData.map(record => record.employeeId)).size;

            document.getElementById('totalCommission').textContent = `$${totalCommission.toLocaleString()}`;
            document.getElementById('totalGP').textContent = `$${totalGP.toLocaleString()}`;
            document.getElementById('avgCommissionRate').textContent = `${avgCommissionRate.toFixed(1)}%`;
            document.getElementById('uniqueEmployees').textContent = uniqueEmployees;

            updateTable();
        }

        function updateTable() {
            const tbody = document.getElementById('commissionTableBody');
            tbody.innerHTML = '';

            if (commissionData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="text-center" style="padding: 48px;">No commission data available</td></tr>';
                return;
            }

            commissionData.forEach(record => {
                const row = document.createElement('tr');
                const tierClass = record.tierStatus === 'Base' ? 'tier-base' : 
                                 record.tierStatus === 'Tier 1' ? 'tier-1' : 'tier-2';
                
                row.innerHTML = `
                    <td>${new Date(record.date).toLocaleDateString()}</td>
                    <td>
                        <div style="font-weight: 600;">${record.employee}</div>
                        <div style="font-size: 13px; color: #4a5568;">${record.type}</div>
                    </td>
                    <td>${record.client}</td>
                    <td>$${record.grossProfit.toLocaleString()}</td>
                    <td>$${record.cumulativeGP.toLocaleString()}</td>
                    <td><span class="tier-indicator ${tierClass}">${record.tierStatus}</span></td>
                    <td>${(record.commissionRate * 100).toFixed(1)}%</td>
                    <td style="font-weight: 600; color: #48bb78;">$${record.commission.toLocaleString()}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function processCommissionFiles() {
            log('File processing will be implemented based on your requirements', 'info');
        }

        function clearFiles() {
            document.getElementById('masterFile').value = '';
            document.getElementById('toaFiles').value = '';
            log('File selection cleared', 'info');
        }

        function exportData() {
            log('Export functionality will be added in future updates', 'info');
        }

        function log(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        document.addEventListener('DOMContentLoaded', function() {
            log('Commission Portal system ready', 'success');
        });
    </script>
</body>
</html>
