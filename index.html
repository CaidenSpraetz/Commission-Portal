<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paramount Commission Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Lato:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Montserrat', 'Lato', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #12096d 0%, #18efe4 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
        }

        .container { max-width: 1400px; margin: 0 auto; }

        .login-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            max-width: 500px;
            margin: 100px auto;
            text-align: center;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 20px;
            font-weight: bold;
            color: #12096d;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .role-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .role-admin { background: #fff3cd; color: #856404; }
        .role-manager { background: #d4edda; color: #155724; }
        .role-user { background: #d1ecf1; color: #0c5460; }

        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            margin-bottom: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #12096d 0%, #18efe4 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(18, 9, 109, 0.4);
        }

        .btn-success { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); }
        .btn-danger { background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%); }
        .btn-secondary { background: linear-gradient(135deg, #6c757d 0%, #495057 100%); }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #12096d 0%, #18efe4 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .commission-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .commission-table th, .commission-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .commission-table th {
            background: linear-gradient(135deg, #12096d 0%, #18efe4 100%);
            color: white;
            font-weight: 600;
        }

        .commission-table tbody tr:hover {
            background: linear-gradient(90deg, #f8f9ff 0%, #ffffff 100%);
        }

        .hidden { display: none; }

        .file-upload {
            background: rgba(255, 255, 255, 0.9);
            border: 2px dashed #12096d;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            text-align: center;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            border-color: #18efe4;
            background: rgba(255, 255, 255, 1);
        }

        .file-input {
            margin: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 300px;
        }

        .log-container {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #00ff88;
            border-radius: 15px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .tier-indicator {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .tier-base { background: #e3f2fd; color: #1565c0; }
        .tier-1 { background: #fff3e0; color: #e65100; }
        .tier-2 { background: #f3e5f5; color: #7b1fa2; }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #12096d;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Screen -->
        <div id="loginScreen" class="login-container">
            <h2 style="color: #12096d; margin-bottom: 30px;">Commission Portal Access</h2>
            
            <div style="margin-bottom: 20px;">
                <button class="btn" onclick="loginAs('admin', 'Administrator', '473682')" style="width: 200px;">Administrator</button><br>
                <small style="color: #666;">Full access to all data and system management</small>
            </div>
            
            <div style="margin-bottom: 20px;">
                <button class="btn btn-success" onclick="loginAs('manager', 'Sales Manager', 'MGR001', ['REC001', 'SAL001'])" style="width: 200px;">Manager</button><br>
                <small style="color: #666;">View team data and upload commission files</small>
            </div>
            
            <div style="margin-bottom: 20px;">
                <button class="btn btn-secondary" onclick="loginAs('user', 'John Smith', 'REC001')" style="width: 200px;">Employee</button><br>
                <small style="color: #666;">View personal commission data only</small>
            </div>
        </div>

        <!-- Main Application -->
        <div id="mainApp" class="hidden">
            <!-- Header -->
            <div class="header">
                <div class="logo">
                    <span>Paramount Commission Portal</span>
                </div>
                <div class="user-info">
                    <span id="welcomeText">User</span>
                    <span id="roleBadge" class="role-badge role-user">User</span>
                    <button class="btn btn-danger" onclick="logout()" style="font-size: 12px; padding: 8px 15px;">Logout</button>
                </div>
            </div>

            <!-- Manager/Admin: File Upload -->
            <div id="managerContent" class="main-content hidden">
                <h3>Upload Commission Files</h3>
                
                <div class="file-upload">
                    <h4 style="color: #12096d; margin-bottom: 15px;">Master Structure File</h4>
                    <input type="file" id="masterFile" class="file-input" accept=".xlsx,.xls" />
                    <p style="color: #666; font-size: 14px;">Upload your Master Structure Excel file</p>
                </div>

                <div class="file-upload">
                    <h4 style="color: #12096d; margin-bottom: 15px;">TOA Files</h4>
                    <input type="file" id="toaFiles" class="file-input" accept=".csv,.xlsx" multiple />
                    <p style="color: #666; font-size: 14px;">Upload your Bullhorn TOA files (multiple files allowed)</p>
                </div>

                <div style="text-align: center; margin: 30px 0;">
                    <button class="btn btn-success" onclick="processCommissionFiles()">
                        <span id="uploadButtonText">Calculate Commissions</span>
                        <span id="uploadSpinner" class="loading hidden"></span>
                    </button>
                    <button class="btn btn-secondary" onclick="clearFiles()">Clear Files</button>
                </div>
            </div>

            <!-- Commission Dashboard -->
            <div class="main-content">
                <h3 id="dashboardTitle">Commission Dashboard</h3>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalCommission">$0</div>
                        <div class="stat-label">Total Commission</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalGP">$0</div>
                        <div class="stat-label">Total Gross Profit</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgCommissionRate">0%</div>
                        <div class="stat-label">Average Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="uniqueEmployees">0</div>
                        <div class="stat-label">Employees</div>
                    </div>
                </div>

                <table class="commission-table">
                    <thead>
                        <tr>
                            <th>Week Ending</th>
                            <th>Employee</th>
                            <th>Client</th>
                            <th>Gross Profit</th>
                            <th>Cumulative GP</th>
                            <th>Tier</th>
                            <th>Rate</th>
                            <th>Commission</th>
                        </tr>
                    </thead>
                    <tbody id="commissionTableBody">
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 40px; color: #666;">
                                Select your role to view commission data
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Activity Log -->
            <div class="log-container" id="logContainer">
                <div style="color: #00ff88;">[SYSTEM] Commission Portal loaded - Local processing mode</div>
                <div style="color: #87ceeb;">[INFO] Role-based access control enabled</div>
                <div style="color: #ffd700;">[READY] Select your access level to begin</div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // User session management
        let currentUser = { userId: null, role: null, name: null, employeeId: null, managedEmployees: [], permissions: [] };
        let commissionData = [];
        let employeeRules = {};

        // Permission system
        const PERMISSIONS = {
            VIEW_ALL_DATA: 'view_all_data',
            UPLOAD_FILES: 'upload_files', 
            VIEW_OWN_DATA: 'view_own_data'
        };

        const ROLE_PERMISSIONS = {
            admin: [PERMISSIONS.VIEW_ALL_DATA, PERMISSIONS.UPLOAD_FILES, PERMISSIONS.VIEW_OWN_DATA],
            manager: [PERMISSIONS.VIEW_ALL_DATA, PERMISSIONS.UPLOAD_FILES, PERMISSIONS.VIEW_OWN_DATA],
            user: [PERMISSIONS.VIEW_OWN_DATA]
        };

        // Authentication system
        function loginAs(role, name, employeeId, managedEmployees = []) {
            currentUser = {
                userId: `user_${employeeId}`,
                role: role,
                name: name,
                employeeId: employeeId,
                managedEmployees: managedEmployees,
                permissions: ROLE_PERMISSIONS[role] || []
            };

            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            updateUIForRole();
            log(`Logged in as ${currentUser.name} (${role})`, 'success');
        }

        function logout() {
            currentUser = { userId: null, role: null, name: null, employeeId: null, managedEmployees: [], permissions: [] };
            commissionData = [];
            
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            
            log('Logged out successfully', 'info');
        }

        function hasPermission(permission) {
            return currentUser.permissions.includes(permission);
        }

        function updateUIForRole() {
            document.getElementById('welcomeText').textContent = currentUser.name;
            document.getElementById('roleBadge').textContent = currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1);
            document.getElementById('roleBadge').className = `role-badge role-${currentUser.role}`;
            
            const managerContent = document.getElementById('managerContent');
            const dashboardTitle = document.getElementById('dashboardTitle');
            
            if (currentUser.role === 'admin') {
                managerContent.classList.remove('hidden');
                dashboardTitle.textContent = 'Commission Dashboard - All Employees';
            } else if (currentUser.role === 'manager') {
                managerContent.classList.remove('hidden');
                dashboardTitle.textContent = 'Commission Dashboard - Your Team';
            } else {
                managerContent.classList.add('hidden');
                dashboardTitle.textContent = 'Your Commission Dashboard';
            }

            loadUserCommissionData();
        }

        // Load commission data - NO SERVER CALLS
        function loadUserCommissionData() {
            log('Loading commission data...', 'info');
            
            if (loadFromBrowserStorage()) {
                filterDataByRole();
                updateDashboard();
                log(`Loaded ${commissionData.length} commission records from browser storage`, 'success');
            } else {
                log('No saved data found, loading demo data...', 'warning');
                loadDemoData();
            }
        }

        // Process commission files locally
        async function processCommissionFiles() {
            const masterFileInput = document.getElementById('masterFile');
            const toaFilesInput = document.getElementById('toaFiles');
            const uploadButton = document.getElementById('uploadButtonText');
            const uploadSpinner = document.getElementById('uploadSpinner');

            if (!hasPermission(PERMISSIONS.UPLOAD_FILES)) {
                log('You do not have permission to upload files', 'error');
                return;
            }

            if (!masterFileInput.files.length || !toaFilesInput.files.length) {
                log('Please select both Master Structure and TOA files', 'error');
                return;
            }

            try {
                uploadButton.textContent = 'Processing...';
                uploadSpinner.classList.remove('hidden');
                
                log('Processing commission files locally...', 'info');
                
                await processMasterFile(masterFileInput.files[0]);
                await processTOAFiles(toaFilesInput.files);
                
                calculateCommissions();
                saveToBrowserStorage();
                updateDashboard();
                
                log(`Commission processing completed: ${commissionData.length} records processed`, 'success');
                clearFiles();

            } catch (error) {
                log(`Error processing files: ${error.message}`, 'error');
            } finally {
                uploadButton.textContent = 'Calculate Commissions';
                uploadSpinner.classList.add('hidden');
            }
        }

        async function processMasterFile(file) {
            const arrayBuffer = await file.arrayBuffer();
            const workbook = XLSX.read(arrayBuffer, { type: 'array' });
            const worksheet = workbook.Sheets[workbook.SheetNames[0]];
            const data = XLSX.utils.sheet_to_json(worksheet);

            employeeRules = {};
            
            data.forEach(row => {
                const employeeId = row['Employee ID'] || row['EmployeeID'] || row['ID'];
                const name = row['Employee Name'] || row['Name'] || row['Employee'];
                const baseRate = parseFloat(row['Base Rate'] || row['BaseRate'] || 0) / 100;
                
                if (employeeId && name) {
                    employeeRules[employeeId] = {
                        name: name,
                        baseRate: baseRate,
                        tiers: []
                    };

                    for (let i = 1; i <= 5; i++) {
                        const tierGP = row[`Tier ${i} GP`] || row[`Tier${i}GP`];
                        const tierRate = row[`Tier ${i} Rate`] || row[`Tier${i}Rate`];
                        
                        if (tierGP && tierRate) {
                            employeeRules[employeeId].tiers.push({
                                threshold: parseFloat(tierGP),
                                rate: parseFloat(tierRate) / 100
                            });
                        }
                    }
                }
            });

            log(`Master Structure processed: ${Object.keys(employeeRules).length} employees`, 'success');
        }

        async function processTOAFiles(files) {
            let allTOAData = [];

            for (const file of files) {
                let fileData;
                if (file.name.endsWith('.csv')) {
                    const text = await file.text();
                    fileData = parseCSV(text);
                } else {
                    const arrayBuffer = await file.arrayBuffer();
                    const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    fileData = XLSX.utils.sheet_to_json(worksheet);
                }
                allTOAData = allTOAData.concat(fileData);
            }

            allTOAData.sort((a, b) => {
                const dateA = new Date(a['WE date'] || a['Week Ending'] || a['Date']);
                const dateB = new Date(b['WE date'] || b['Week Ending'] || b['Date']);
                return dateA - dateB;
            });

            window.processedTOAData = allTOAData;
            log(`TOA processing complete: ${allTOAData.length} records`, 'success');
        }

        function calculateCommissions() {
            commissionData = [];
            const cumulativeGP = {};
            
            Object.keys(employeeRules).forEach(id => {
                cumulativeGP[id] = 0;
            });

            window.processedTOAData.forEach(record => {
                const weDate = record['WE date'] || record['Week Ending'] || record['Date'];
                const gp = parseFloat(record.GP || record['Gross Profit'] || record['GrossProfit'] || 0);
                const client = record.Client || record['Client Name'] || record['ClientName'];
                const recruiterId = record['Placement Recruiter ID'] || record['RecruiterID'];
                const salesId = record['Placement Sales ID'] || record['SalesID'];

                if (recruiterId && employeeRules[recruiterId]) {
                    cumulativeGP[recruiterId] += gp;
                    const rate = getCommissionRate(employeeRules[recruiterId], cumulativeGP[recruiterId]);
                    const commission = gp * rate;
                    
                    commissionData.push({
                        date: weDate,
                        employee: employeeRules[recruiterId].name,
                        employeeId: recruiterId,
                        client: client,
                        grossProfit: gp,
                        cumulativeGP: cumulativeGP[recruiterId],
                        commissionRate: rate,
                        commission: commission,
                        type: 'Recruiter',
                        tierStatus: getTierStatus(employeeRules[recruiterId], cumulativeGP[recruiterId])
                    });
                }

                if (salesId && employeeRules[salesId]) {
                    cumulativeGP[salesId] += gp;
                    const rate = getCommissionRate(employeeRules[salesId], cumulativeGP[salesId]);
                    const commission = gp * rate;
                    
                    commissionData.push({
                        date: weDate,
                        employee: employeeRules[salesId].name,
                        employeeId: salesId,
                        client: client,
                        grossProfit: gp,
                        cumulativeGP: cumulativeGP[salesId],
                        commissionRate: rate,
                        commission: commission,
                        type: 'Sales',
                        tierStatus: getTierStatus(employeeRules[salesId], cumulativeGP[salesId])
                    });
                }
            });

            commissionData.sort((a, b) => new Date(a.date) - new Date(b.date));
        }

        function getCommissionRate(employee, cumulativeGP) {
            let rate = employee.baseRate;
            const sortedTiers = employee.tiers.sort((a, b) => b.threshold - a.threshold);
            
            for (const tier of sortedTiers) {
                if (cumulativeGP >= tier.threshold) {
                    rate = tier.rate;
                    break;
                }
            }
            return rate;
        }

        function getTierStatus(employee, cumulativeGP) {
            const sortedTiers = employee.tiers.sort((a, b) => b.threshold - a.threshold);
            for (let i = 0; i < sortedTiers.length; i++) {
                if (cumulativeGP >= sortedTiers[i].threshold) {
                    return `Tier ${sortedTiers.length - i}`;
                }
            }
            return 'Base';
        }

        function parseCSV(text) {
            const lines = text.split('\n');
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const data = [];

            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index] || '';
                    });
                    data.push(row);
                }
            }
            return data;
        }

        function saveToBrowserStorage() {
            try {
                const dataToSave = {
                    commissionData: commissionData,
                    employeeRules: employeeRules,
                    timestamp: new Date().toISOString(),
                    uploadedBy: currentUser.userId
                };
                
                localStorage.setItem('commissionPortalData', JSON.stringify(dataToSave));
                log('Commission data saved locally', 'success');
            } catch (error) {
                log(`Error saving data: ${error.message}`, 'warning');
            }
        }

        function loadFromBrowserStorage() {
            try {
                const savedData = localStorage.getItem('commissionPortalData');
                if (savedData) {
                    const parsed = JSON.parse(savedData);
                    commissionData = parsed.commissionData || [];
                    employeeRules = parsed.employeeRules || {};
                    return true;
                }
            } catch (error) {
                log(`Error loading saved data: ${error.message}`, 'warning');
            }
            return false;
        }

        function filterDataByRole() {
            if (currentUser.role === 'user') {
                commissionData = commissionData.filter(record => record.employeeId === currentUser.employeeId);
            } else if (currentUser.role === 'manager') {
                const teamIds = [...currentUser.managedEmployees, currentUser.employeeId];
                commissionData = commissionData.filter(record => teamIds.includes(record.employeeId));
            }
        }

        function updateDashboard() {
            const totalCommission = commissionData.reduce((sum, record) => sum + (record.commission || 0), 0);
            const totalGP = commissionData.reduce((sum, record) => sum + (record.grossProfit || 0), 0);
            const avgCommissionRate = totalGP > 0 ? (totalCommission / totalGP) * 100 : 0;
            const uniqueEmployees = new Set(commissionData.map(record => record.employeeId)).size;

            document.getElementById('totalCommission').textContent = `$${totalCommission.toLocaleString('en-US', {maximumFractionDigits: 0})}`;
            document.getElementById('totalGP').textContent = `$${totalGP.toLocaleString('en-US', {maximumFractionDigits: 0})}`;
            document.getElementById('avgCommissionRate').textContent = `${avgCommissionRate.toFixed(1)}%`;
            document.getElementById('uniqueEmployees').textContent = uniqueEmployees;

            updateCommissionTable();
        }

        function updateCommissionTable() {
            const tableBody = document.getElementById('commissionTableBody');
            tableBody.innerHTML = '';

            if (commissionData.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="8" style="text-align: center; padding: 40px; color: #666;">No commission data available. Upload files to process commission calculations.</td>';
                tableBody.appendChild(row);
                return;
            }

            commissionData.forEach(record => {
                const row = document.createElement('tr');
                const tierClass = record.tierStatus === 'Base' ? 'tier-base' : 
                                 record.tierStatus === 'Tier 1' ? 'tier-1' : 'tier-2';
                
                row.innerHTML = `
                    <td>${new Date(record.date).toLocaleDateString()}</td>
                    <td>
                        <div style="font-weight: bold;">${record.employee}</div>
                        <div style="font-size: 12px; color: #666;">${record.type}</div>
                    </td>
                    <td>${record.client}</td>
                    <td>${record.grossProfit.toLocaleString('en-US')}</td>
                    <td>${record.cumulativeGP.toLocaleString('en-US')}</td>
                    <td><span class="tier-indicator ${tierClass}">${record.tierStatus}</span></td>
                    <td>${(record.commissionRate * 100).toFixed(1)}%</td>
                    <td style="font-weight: bold; color: #28a745;">${record.commission.toLocaleString('en-US', {maximumFractionDigits: 0})}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        function loadDemoData() {
            const demoData = [
                {
                    date: '2025-01-07',
                    employee: 'Elane Buresi',
                    employeeId: '473682',
                    client: 'ABC Corp',
                    grossProfit: 15000,
                    cumulativeGP: 15000,
                    commissionRate: 0.33,
                    commission: 4950,
                    type: 'Recruiter',
                    tierStatus: 'Base'
                },
                {
                    date: '2025-01-14',
                    employee: 'John Smith',
                    employeeId: 'REC001',
                    client: 'XYZ Ltd',
                    grossProfit: 22000,
                    cumulativeGP: 22000,
                    commissionRate: 0.30,
                    commission: 6600,
                    type: 'Recruiter',
                    tierStatus: 'Base'
                }
            ];

            if (currentUser.role === 'user') {
                commissionData = demoData.filter(record => record.employeeId === currentUser.employeeId);
            } else if (currentUser.role === 'manager') {
                const teamIds = [...currentUser.managedEmployees, currentUser.employeeId];
                commissionData = demoData.filter(record => teamIds.includes(record.employeeId));
            } else {
                commissionData = demoData;
            }

            updateDashboard();
            log('Demo data loaded based on your role', 'info');
        }

        function clearFiles() {
            document.getElementById('masterFile').value = '';
            document.getElementById('toaFiles').value = '';
            log('File selections cleared', 'info');
        }

        function log(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            
            let color, prefix;
            switch(type) {
                case 'success': color = '#28a745'; prefix = '[SUCCESS]'; break;
                case 'error': color = '#dc3545'; prefix = '[ERROR]'; break;
                case 'warning': color = '#ffc107'; prefix = '[WARNING]'; break;
                default: color = '#87ceeb'; prefix = '[INFO]'; break;
            }
            
            const logEntry = document.createElement('div');
            logEntry.style.color = color;
            logEntry.innerHTML = `${prefix} [${timestamp}] ${message}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            log('Commission Portal loaded successfully - Local processing mode', 'success');
            log('Select your access level to begin using the system', 'info');
        });
    </script>
</body>
</html>
